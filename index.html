<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محفظة العملات المشفرة الأمريكية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        /* تنسيقات واجهة التسجيل */
        .auth-container {
            display: flex;
            min-height: 100vh;
        }
        
        .welcome-section {
            flex: 1;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,215,0,0.1) 0%, transparent 50%);
            z-index: 1;
        }
        
        .welcome-content {
            position: relative;
            z-index: 2;
        }
        
        .welcome-section h1 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            text-align: center;
        }
        
        .welcome-section p {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 40px;
            color: #cccccc;
            max-width: 500px;
            text-align: center;
        }
        
        .features {
            list-style: none;
            margin-top: 30px;
        }
        
        .features li {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
            color: #e6e6e6;
            justify-content: center;
        }
        
        .features li i {
            margin-left: 15px;
            font-size: 1.3rem;
            color: #ffd700;
        }
        
        .form-section {
            flex: 1;
            background: #ffffff;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        .form-container {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            border: 1px solid #f5c6cb;
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .form-header h2 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .form-header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .form-control:focus {
            border-color: #ffd700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
            outline: none;
            background: white;
        }
        
        .password-toggle {
            position: absolute;
            left: 15px;
            top: 45px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .buttons-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e8e8e8;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .form-footer a {
            color: #ffd700;
            text-decoration: none;
            font-weight: 500;
        }
        
        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .remember-me input {
            width: 18px;
            height: 18px;
        }
        
        .forgot-password {
            color: #ffd700;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        /* تنسيقات واجهة المحفظة */
        .wallet-container {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            padding: 20px;
            position: relative;
        }
        
        .wallet-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 40px;
        }
        
        .wallet-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .wallet-header h2 {
            font-size: 1.5rem;
            color: #cccccc;
            font-weight: normal;
        }
        
        /* زر اللغة في أعلى اليسار */
        .language-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        
        .language-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #cccccc;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .language-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 5px;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }
        
        .language-dropdown.show {
            display: block;
        }
        
        .language-option {
            padding: 8px 12px;
            color: #cccccc;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 4px;
        }
        
        .language-option:hover {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        /* زر دعم العملاء في المنتصف */
        .support-selector {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        
        .support-btn {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .support-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }
        
        /* زر أنا في أعلى اليمين */
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #cccccc;
        }
        
        .user-menu {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-btn {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .user-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 5px;
            min-width: 180px;
            display: none;
            z-index: 1000;
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .user-email {
            padding: 8px 12px;
            color: #ffd700;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        
        .logout-btn {
            background: rgba(255, 100, 100, 0.2);
            color: #ff8a8a;
            border: 1px solid rgba(255, 100, 100, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            width: 100%;
            text-align: right;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .logout-btn:hover {
            background: rgba(255, 100, 100, 0.3);
        }
        
        /* شريط التنقل في الأسفل */
        .wallet-nav {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            display: flex;
            justify-content: space-around;
            background: rgba(30, 30, 30, 0.95);
            padding: 15px 10px;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            z-index: 100;
        }
        
        .nav-btn {
            background: transparent;
            border: none;
            color: #cccccc;
            padding: 12px 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
            max-width: 80px;
        }
        
        .nav-btn.active {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-btn i {
            font-size: 1.2rem;
        }
        
        /* بطاقة الرصيد */
        .balance-card {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            text-align: center;
            color: #000;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .balance-label {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .balance-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .balance-equivalent {
            font-size: 1rem;
            opacity: 0.7;
        }
        
        /* قائمة العملات */
        .currency-list {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .currency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .currency-item:last-child {
            border-bottom: none;
        }
        
        .currency-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .currency-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .currency-icon.usdt {
            background: rgba(38, 161, 123, 0.2);
            color: #26a17b;
        }
        
        .currency-icon.btc {
            background: rgba(247, 147, 26, 0.2);
            color: #f7931a;
        }
        
        .currency-icon.eth {
            background: rgba(98, 126, 234, 0.2);
            color: #627eea;
        }
        
        .currency-details h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .currency-details span {
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        .currency-amount {
            text-align: right;
        }
        
        .currency-amount .amount {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .currency-amount .value {
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        /* بطاقة السحب */
        .send-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .send-form {
            margin-top: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .send-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* سجل المعاملات */
        .transactions-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .transaction-icon.receive {
            background: rgba(0, 255, 0, 0.2);
            color: #00cc00;
        }
        
        .transaction-icon.send {
            background: rgba(255, 100, 100, 0.2);
            color: #ff8a8a;
        }
        
        .transaction-details h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .transaction-details span {
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        .transaction-amount {
            text-align: right;
        }
        
        .transaction-amount.receive {
            color: #00cc00;
        }
        
        .transaction-amount.send {
            color: #ff8a8a;
        }
        
        .no-transactions {
            text-align: center;
            padding: 40px;
            color: #cccccc;
        }
        
        /* الإشعارات */
        .notifications-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .notification-details h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .notification-details span {
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: #888;
        }
        
        .no-notifications {
            text-align: center;
            padding: 40px;
            color: #cccccc;
        }
        
        /* بطاقة تعبئة الرصيد */
        .receive-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .receive-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .receive-header h3 {
            font-size: 1.6rem;
            color: #ffd700;
        }
        
        .fee-badge {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #a0a0a0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        hr {
            border: none;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 30px 0;
        }
        
        .on-chain-title {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.3rem;
            color: #ffd700;
        }
        
        .networks-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 35px;
        }
        
        .network-option {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
            position: relative;
        }
        
        .network-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .network-option.active {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            transform: translateY(-3px);
        }
        
        .network-option .icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        /* أشكال الرموز الأصلية */
        .icon.erc20 {
            color: #3c3c3d;
        }
        
        .icon.trc20 {
            color: #ff060a;
        }
        
        .icon.sol {
            color: #00ffbd;
        }
        
        .icon.bep20 {
            color: #f0b90b;
        }
        
        .icon.btc {
            color: #f7931a;
        }
        
        .icon.eth {
            color: #627eea;
        }
        
        .network-symbol {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: #00cc00;
            background: rgba(0, 255, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .network-symbol.usdt {
            color: #26a17b;
            background: rgba(38, 161, 123, 0.1);
        }
        
        .network-symbol.btc {
            color: #f7931a;
            background: rgba(247, 147, 26, 0.1);
        }
        
        .address-section {
            margin-top: 25px;
        }
        
        .address-label {
            margin-bottom: 15px;
            color: #a0a0a0;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .address-box {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 20px;
            word-break: break-all;
            text-align: center;
            font-family: monospace;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            color: #ffd700;
            line-height: 1.6;
        }
        
        .address-box:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .address-box.copied {
            background: rgba(0, 200, 0, 0.2);
            border-color: #00cc00;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .wallet-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }
        
        .wallet-btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }
        
        .wallet-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .wallet-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .wallet-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .warning {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 100, 100, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 100, 100, 0.3);
            text-align: center;
            font-size: 1rem;
            color: #ff8a8a;
        }
        
        .network-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            color: #ffed4e;
            display: none;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 1000;
            border: 1px solid #ffd700;
        }
        
        /* قسم VIP */
        .vip-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .vip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .vip-header h3 {
            font-size: 1.6rem;
            color: #ffd700;
        }
        
        .vip-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .vip-timer {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .vip-timer h4 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffed4e;
            direction: ltr;
        }
        
        .vip-levels {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .vip-level {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s;
            position: relative;
        }
        
        .vip-level:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .vip-level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .vip-level-title {
            font-size: 1.3rem;
            color: #ffd700;
            font-weight: bold;
        }
        
        .vip-level-img {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
        }
        
        .vip-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .vip-detail {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .vip-detail-label {
            font-size: 0.9rem;
            color: #cccccc;
            margin-bottom: 5px;
        }
        
        .vip-detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .vip-profit {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .vip-profit-item {
            text-align: center;
            padding: 8px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 8px;
        }
        
        .vip-profit-label {
            font-size: 0.8rem;
            color: #cccccc;
            margin-bottom: 3px;
        }
        
        .vip-profit-value {
            font-size: 1rem;
            font-weight: bold;
            color: #ffed4e;
        }
        
        .vip-open-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .vip-open-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .vip-open-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* أنماط نظام القفل التلقائي في VIP */
        .vip-lock {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .vip-level.unlocked .vip-lock {
            background: rgba(0, 255, 0, 0.9);
        }
        
        .vip-level.locked .vip-lock i {
            transform: rotate(45deg);
        }
        
        .vip-open-btn.disabled {
            background: #666 !important;
            color: #999 !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .vip-open-btn.success {
            background: linear-gradient(135deg, #00b09b, #96c93d) !important;
            color: white !important;
        }
        
        .vip-status {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .vip-status.active {
            color: #00cc00;
        }
        
        .vip-status.pending {
            color: #ffd700;
        }
        
        .vip-status.locked {
            color: #ff6666;
        }
        
        /* مؤشر التحميل */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
            flex-direction: column;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s ease-in-out infinite;
        }
        
        .loading-text {
            margin-top: 15px;
            color: #ffd700;
            font-size: 1.1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* لوحة تحكم المسؤول */
        .admin-container {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            padding: 20px;
            position: relative;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 40px;
        }
        
        .admin-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .admin-header h2 {
            font-size: 1.5rem;
            color: #cccccc;
            font-weight: normal;
        }
        
        .admin-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .admin-nav-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #cccccc;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .admin-nav-btn.active {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .admin-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .admin-section {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .users-table th, .users-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .users-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            font-weight: bold;
        }
        
        .users-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 5px;
            transition: all 0.3s;
        }
        
        .add-balance-btn {
            background: rgba(0, 255, 0, 0.2);
            color: #00cc00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .add-balance-btn:hover {
            background: rgba(0, 255, 0, 0.3);
        }
        
        .withdraw-balance-btn {
            background: rgba(255, 100, 100, 0.2);
            color: #ff8a8a;
            border: 1px solid rgba(255, 100, 100, 0.3);
        }
        
        .withdraw-balance-btn:hover {
            background: rgba(255, 100, 100, 0.3);
        }
        
        .ban-user-btn {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6666;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .ban-user-btn:hover {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .unban-user-btn {
            background: rgba(0, 0, 255, 0.2);
            color: #6666ff;
            border: 1px solid rgba(0, 0, 255, 0.3);
        }
        
        .unban-user-btn:hover {
            background: rgba(0, 0, 255, 0.3);
        }
        
        .user-banned {
            color: #ff6666;
            font-weight: bold;
        }
        
        .balance-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .balance-form input {
            flex: 1;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
        }
        
        .balance-form button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .balance-form button:hover {
            background: rgba(255, 215, 0, 0.3);
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .stat-card h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #cccccc;
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .admin-login-form {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        /* قسم الإحالة الجديد */
        .referral-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        
        .referral-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .referral-header h3 {
            font-size: 1.6rem;
            color: #ffd700;
        }
        
        .referral-code-box {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .referral-code {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
            font-family: monospace;
        }
        
        .referral-link-box {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 20px;
            word-break: break-all;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .referral-link {
            font-size: 1.1rem;
            color: #ffd700;
            line-height: 1.6;
            font-family: monospace;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .referral-stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .referral-stat-label {
            font-size: 0.9rem;
            color: #cccccc;
            margin-bottom: 10px;
        }
        
        .referral-stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .referral-commissions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .commission-level {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .commission-level-label {
            font-size: 1rem;
            color: #cccccc;
            margin-bottom: 10px;
        }
        
        .commission-level-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffed4e;
        }
        
        .commission-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #888;
        }
        
        /* تحسينات للشاشات الصغيرة */
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .welcome-section, .form-section {
                padding: 40px 20px;
            }
            
            .networks-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .buttons-group {
                flex-direction: column;
            }
            
            .wallet-nav {
                padding: 10px 5px;
            }
            
            .nav-btn {
                font-size: 0.7rem;
                padding: 8px 3px;
            }
            
            .nav-btn i {
                font-size: 1rem;
            }
            
            .currency-list, .send-card, .receive-card, .transactions-card, .notifications-card, .vip-card, .referral-card {
                margin: 10px;
                padding: 20px;
            }
            
            .admin-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .users-table {
                font-size: 0.8rem;
            }
            
            .users-table th, .users-table td {
                padding: 8px 10px;
            }
            
            .referral-stats, .referral-commissions {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .wallet-header h1 {
                font-size: 1.5rem;
            }
            
            .balance-amount {
                font-size: 2rem;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .wallet-btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .networks-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- مؤشر التحميل -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p class="loading-text">جاري التحميل...</p>
    </div>
    
    <div class="container">
        <!-- واجهة تسجيل الدخول للمسؤول -->
        <div class="auth-container" id="authContainer">
            <div class="welcome-section">
                <div class="welcome-content">
                    <h1>محفظة العملات المشفرة الأمريكية</h1>
                    <p>انضم إلى مجتمعاتنا واستفد من جميع المزايا التي نقدمها. سجل الآن وابدأ رحلتك معنا.</p>
                    <ul class="features">
                        <li><i class="fas fa-check"></i> وصول سريع وسهل</li>
                        <li><i class="fas fa-check"></i> تجربة مستخدم محسنة</li>
                        <li><i class="fas fa-check"></i> دعم فني متواصل</li>
                        <li><i class="fas fa-check"></i> تحديثات مستمرة</li>
                    </ul>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-container">
                    <!-- نموذج التسجيل -->
                    <form class="register-form" id="registrationForm">
                        <div class="success-message" id="successMessage">
                            <i class="fas fa-check-circle"></i> تم إنشاء حسابك بنجاح! يتم توجيهك إلى المحفظة...
                        </div>
                        
                        <div class="error-message" id="errorMessage"></div>
                        
                        <div class="form-header">
                            <h2>التسجيل عن طريق البريد الإلكتروني</h2>
                            <p>املأ النموذج أدناه لإنشاء حساب جديد</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">بريد إلكتروني</label>
                            <input type="email" id="email" class="form-control" placeholder="أدخل بريدك الإلكتروني" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">كلمة المرور</label>
                            <input type="password" id="password" class="form-control" placeholder="أدخل كلمة المرور" required>
                            <button type="button" class="password-toggle" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">تأكيد كلمة المرور</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="أعد إدخال كلمة المرور" required>
                            <button type="button" class="password-toggle" id="toggleConfirmPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="invitationCode">شفرة الدعوة (اختياري)</label>
                            <input type="text" id="invitationCode" class="form-control" placeholder="أدخل شفرة الدعوة (اختياري)">
                        </div>
                        
                        <div class="buttons-group">
                            <button type="submit" class="btn btn-primary">اشتراك</button>
                            <button type="button" class="btn btn-secondary" id="showLoginBtn">تسجيل الدخول</button>
                        </div>
                        
                        <div class="form-footer">
                            <p>بالنقر على "اشتراك"، فإنك توافق على <a href="#">شروط الخدمة</a> و<a href="#">سياسة الخصوصية</a></p>
                        </div>
                    </form>
                    
                    <!-- نموذج تسجيل الدخول -->
                    <form class="login-form" id="loginForm" style="display: none;">
                        <div class="error-message" id="loginErrorMessage"></div>
                        
                        <div class="form-header">
                            <h2>تسجيل الدخول</h2>
                            <p>أدخل بياناتك للدخول إلى حسابك</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginEmail">بريد إلكتروني</label>
                            <input type="email" id="loginEmail" class="form-control" placeholder="أدخل بريدك الإلكتروني" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginPassword">كلمة المرور</label>
                            <input type="password" id="loginPassword" class="form-control" placeholder="أدخل كلمة المرور" required>
                            <button type="button" class="password-toggle" id="toggleLoginPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        
                        <div class="login-options">
                            <div class="remember-me">
                                <input type="checkbox" id="rememberMe">
                                <label for="rememberMe">تذكرني</label>
                            </div>
                            <a href="#" class="forgot-password">نسيت كلمة المرور؟</a>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="margin-bottom: 15px;">تسجيل الدخول</button>
                        <button type="button" class="btn btn-secondary" id="showRegisterBtn">إنشاء حساب جديد</button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- واجهة المحفظة (تظهر بعد التسجيل) -->
        <div class="wallet-container" id="walletContainer">
            <!-- زر اللغة في أعلى اليسار -->
            <div class="language-selector">
                <button class="language-btn" id="languageBtn">
                    <i class="fas fa-globe"></i>
                    عربي
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="language-dropdown" id="languageDropdown">
                    <div class="language-option" data-lang="pl">Polski</div>
                    <div class="language-option" data-lang="en">English</div>
                    <div class="language-option" data-lang="fr">Français</div>
                    <div class="language-option" data-lang="it">italiano</div>
                    <div class="language-option" data-lang="ja">日本語</div>
                    <div class="language-option" data-lang="ko">한국인</div>
                    <div class="language-option" data-lang="de">Deutsch</div>
                    <div class="language-option" data-lang="ru">Русский</div>
                    <div class="language-option" data-lang="vi">Tiếng Việt</div>
                    <div class="language-option" data-lang="pt">Português</div>
                    <div class="language-option" data-lang="tr">Türkçe</div>
                    <div class="language-option" data-lang="es">español</div>
                    <div class="language-option" data-lang="fa">فارسی</div>
                    <div class="language-option" data-lang="ar">عربي</div>
                    <div class="language-option" data-lang="id">bahasa Indonesia</div>
                    <div class="language-option" data-lang="el">Ελληνικά</div>
                    <div class="language-option" data-lang="ms">Melayu</div>
                    <div class="language-option" data-lang="th">แบบไทย</div>
                    <div class="language-option" data-lang="la">Latinus</div>
                    <div class="language-option" data-lang="hi">हिंदी</div>
                    <div class="language-option" data-lang="bn">বাংলা</div>
                    <div class="language-option" data-lang="ur">اردو</div>
                    <div class="language-option" data-lang="zh-Hant">繁体中文</div>
                    <div class="language-option" data-lang="sq">shqiptare</div>
                </div>
            </div>
            
            <!-- زر دعم العملاء في المنتصف -->
            <div class="support-selector">
                <a href="https://t.me/American_38X" target="_blank" class="support-btn">
                    <i class="fas fa-headset"></i>
                    دعم العملاء
                </a>
            </div>
            
            <!-- زر أنا في أعلى اليمين -->
            <div class="user-info">
                <div class="user-menu">
                    <button class="user-btn" id="userBtn">
                        <i class="fas fa-user"></i>
                        أنا
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-email" id="userEmailDisplay">user@example.com</div>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            تسجيل الخروج
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="wallet-header">
                <h1>محفظة العملات المشفرة الأمريكية</h1>
                <h2 id="walletSubtitle">الرصيد</h2>
            </div>
            
            <!-- بطاقة الرصيد -->
            <div class="balance-card" id="balanceCard">
                <div class="balance-label">إجمالي الرصيد</div>
                <div class="balance-amount" id="totalBalance">$0.00</div>
                <div class="balance-equivalent" id="balanceEquivalent">≈ 0.000000 BTC</div>
            </div>
            
            <!-- قائمة العملات -->
            <div class="currency-list" id="currencyList">
                <div class="currency-item">
                    <div class="currency-info">
                        <div class="currency-icon usdt">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="currency-details">
                            <h3>USDT</h3>
                            <span>Tether</span>
                        </div>
                    </div>
                    <div class="currency-amount">
                        <div class="amount" id="usdtAmount">0.00 USDT</div>
                        <div class="value" id="usdtValue">$0.00</div>
                    </div>
                </div>
                
                <div class="currency-item">
                    <div class="currency-info">
                        <div class="currency-icon btc">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                        <div class="currency-details">
                            <h3>Bitcoin</h3>
                            <span>BTC</span>
                        </div>
                    </div>
                    <div class="currency-amount">
                        <div class="amount" id="btcAmount">0.000000 BTC</div>
                        <div class="value" id="btcValue">$0.00</div>
                    </div>
                </div>
                
                <div class="currency-item">
                    <div class="currency-info">
                        <div class="currency-icon eth">
                            <i class="fab fa-ethereum"></i>
                        </div>
                        <div class="currency-details">
                            <h3>Ethereum</h3>
                            <span>ETH</span>
                        </div>
                    </div>
                    <div class="currency-amount">
                        <div class="amount" id="ethAmount">0.00 ETH</div>
                        <div class="value" id="ethValue">$0.00</div>
                    </div>
                </div>
            </div>
            
            <!-- بطاقة السحب -->
            <div class="send-card" id="sendCard">
                <div class="receive-header">
                    <h3>سحب الأموال</h3>
                    <div class="fee-badge">منخفض الرسوم</div>
                </div>
                
                <div class="description">
                    اسحب الأموال بسرعة وأمان إلى أي عنوان محفظة حول العالم.
                </div>
                
                <form class="send-form" id="sendForm">
                    <div class="form-group">
                        <label for="sendCurrency">اختر العملة</label>
                        <select id="sendCurrency" class="form-control" required>
                            <option value="USDT">USDT - Tether</option>
                            <option value="BTC">BTC - Bitcoin</option>
                            <option value="ETH">ETH - Ethereum</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="sendAddress">عنوان المحفظة المستلم</label>
                        <input type="text" id="sendAddress" class="form-control" placeholder="أدخل عنوان المحفظة" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sendAmount">المبلغ</label>
                            <input type="number" id="sendAmount" class="form-control" placeholder="0.00" step="0.000001" required>
                        </div>
                        <div class="form-group">
                            <label for="sendNetwork">الشبكة</label>
                            <select id="sendNetwork" class="form-control" required>
                                <option value="ERC20">ERC20</option>
                                <option value="TRC20">TRC20</option>
                                <option value="BEP20">BEP20</option>
                                <option value="BTC">BTC Network</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="send-actions">
                        <button type="submit" class="wallet-btn wallet-btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            سحب الآن
                        </button>
                        <button type="button" class="wallet-btn wallet-btn-secondary" id="cancelSend">
                            إلغاء
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- سجل المعاملات -->
            <div class="transactions-card" id="transactionsCard">
                <div class="receive-header">
                    <h3>سجل المعاملات</h3>
                    <div class="fee-badge">آخر النشاطات</div>
                </div>
                
                <div id="transactionsList">
                    <div class="no-transactions">
                        <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>لا توجد معاملات حتى الآن</p>
                        <small>سيظهر سجل المعاملات هنا بعد إجراء أول عملية</small>
                    </div>
                </div>
            </div>
            
            <!-- الإشعارات -->
            <div class="notifications-card" id="notificationsCard">
                <div class="receive-header">
                    <h3>الإشعارات</h3>
                    <div class="fee-badge">جديد</div>
                </div>
                <div id="notificationsList">
                    <div class="no-notifications">
                        <i class="fas fa-bell" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>لا توجد إشعارات</p>
                        <small>سيتم إعلامك هنا بأي تحديثات جديدة</small>
                    </div>
                </div>
            </div>
            
            <!-- بطاقة تعبئة الرصيد -->
            <div class="receive-card" id="receiveCard">
                <div class="receive-header">
                    <h3>تعبئة الرصيد</h3>
                    <div class="fee-badge">سهل وسريع</div>
                </div>
                
                <div class="description">
                    قم بمشاركة هذا العنوان ودع المرسلين يستخدمون محفظة خارجية لدفع المبلغ لك.
                </div>
                
                <hr>
                
                <div class="on-chain-title">تعبئة الرصيد على الشبكة</div>
                
                <div class="networks-grid" id="networksGrid">
                    <div class="network-option active" data-network="ERC20">
                        <span class="network-symbol usdt">USDT</span>
                        <div class="icon erc20">
                            <i class="fab fa-ethereum"></i>
                        </div>
                        <div>ERC20</div>
                    </div>
                    <div class="network-option" data-network="TRC20">
                        <span class="network-symbol usdt">USDT</span>
                        <div class="icon trc20">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div>TRC20</div>
                    </div>
                    <div class="network-option" data-network="SOL">
                        <span class="network-symbol usdt">USDT</span>
                        <div class="icon sol">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div>SOL</div>
                    </div>
                    <div class="network-option" data-network="BEP20">
                        <span class="network-symbol usdt">USDT</span>
                        <div class="icon bep20">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div>BEP20</div>
                    </div>
                    <div class="network-option" data-network="BTC">
                        <span class="network-symbol btc">BTC</span>
                        <div class="icon btc">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                        <div>BTC</div>
                    </div>
                    <div class="network-option" data-network="ETH">
                        <span class="network-symbol usdt">USDT</span>
                        <div class="icon eth">
                            <i class="fab fa-ethereum"></i>
                        </div>
                        <div>ETH</div>
                    </div>
                </div>
                
                <div class="address-section">
                    <div class="address-label">عنوانك</div>
                    <div class="address-box" id="addressBox">
                        0x8574dE94D5DF925e8C9Db6282527Fd1539F9eD85
                    </div>
                    
                    <div class="network-info" id="networkInfo">
                        فقط رمز USDT على شبكة ERC20 يُرسل إلى هذا العنوان
                    </div>
                    
                    <div class="actions">
                        <button class="wallet-btn wallet-btn-primary" id="shareBtn">
                            <i class="fas fa-share-alt"></i>
                            مشاركة
                        </button>
                        <button class="wallet-btn wallet-btn-secondary" id="copyBtn">
                            <i class="far fa-copy"></i>
                            نسخ العنوان
                        </button>
                    </div>
                    
                    <div class="warning">
                        انقر على العنوان ليتم النسخ تلقائياً
                    </div>
                </div>
            </div>
            
            <!-- قسم VIP -->
            <div class="vip-card" id="vipCard">
                <div class="vip-header">
                    <h3>كبار الشخصيات VIP</h3>
                    <div class="vip-badge">مميز</div>
                </div>
                
                <!-- مؤقت 24 ساعة -->
                <div class="vip-timer">
                    <h4>المؤقت اليومي</h4>
                    <div class="timer-display" id="vipTimer">24:00:00</div>
                    <small>يتجدد كل 24 ساعة</small>
                </div>
                
                <div class="vip-levels" id="vipLevels">
                    <!-- سيتم إضافة مستويات VIP هنا عبر JavaScript -->
                </div>
            </div>
            
            <!-- قسم الإحالة الجديد -->
            <div class="referral-card" id="referralCard">
                <div class="referral-header">
                    <h3>نظام الإحالة</h3>
                    <div class="fee-badge">ربح</div>
                </div>
                
                <div class="referral-code-box">
                    <div class="referral-code" id="referralCodeDisplay">991271</div>
                    <button class="wallet-btn wallet-btn-primary" id="copyReferralCode">
                        <i class="far fa-copy"></i>
                        نسخ شفرة الدعوة
                    </button>
                </div>
                
                <div class="referral-link-box">
                    <div class="referral-link" id="referralLinkDisplay">
                        https://american-html.vercel.app/#/register?ref=991271
                    </div>
                    <button class="wallet-btn wallet-btn-secondary" id="copyReferralLinkFull">
                        <i class="far fa-copy"></i>
                        نسخ رابط الإحالة
                    </button>
                </div>
                
                <div class="referral-stats">
                    <div class="referral-stat">
                        <div class="referral-stat-label">فريق الانسحاب</div>
                        <div class="referral-stat-value">$0.00</div>
                    </div>
                    <div class="referral-stat">
                        <div class="referral-stat-label">فريق إعادة الشحن</div>
                        <div class="referral-stat-value">$0.00</div>
                    </div>
                    <div class="referral-stat">
                        <div class="referral-stat-label">حجم الفريق</div>
                        <div class="referral-stat-value">0</div>
                    </div>
                    <div class="referral-stat">
                        <div class="referral-stat-label">فريق جديد</div>
                        <div class="referral-stat-value">0</div>
                    </div>
                </div>
                
                <div class="referral-commissions">
                    <div class="commission-level">
                        <div class="commission-level-label">المستوى 1</div>
                        <div class="commission-level-value">6%</div>
                        <div class="commission-stats">
                            <span>مسجل / صالح: 0/0</span>
                            <span>إجمالي الدخل: 0</span>
                        </div>
                    </div>
                    <div class="commission-level">
                        <div class="commission-level-label">المستوى 2</div>
                        <div class="commission-level-value">2%</div>
                        <div class="commission-stats">
                            <span>مسجل / صالح: 0/0</span>
                            <span>إجمالي الدخل: 0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- شريط التنقل في الأسفل -->
            <div class="wallet-nav">
                <button class="nav-btn active" id="balanceBtn">
                    <i class="fas fa-wallet"></i>
                    الرصيد
                </button>
                <button class="nav-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                    سحب
                </button>
                <button class="nav-btn" id="receiveBtn">
                    <i class="fas fa-qrcode"></i>
                    تعبئة
                </button>
                <button class="nav-btn" id="vipBtn">
                    <i class="fas fa-crown"></i>
                    VIP
                </button>
                <button class="nav-btn" id="referralNavBtn">
                    <i class="fas fa-users"></i>
                    الإحالة
                </button>
                <button class="nav-btn" id="transactionsBtn">
                    <i class="fas fa-history"></i>
                    المعاملات
                </button>
            </div>
        </div>
        
        <!-- لوحة تحكم المسؤول -->
        <div class="admin-container" id="adminContainer">
            <div class="admin-header">
                <h1>لوحة تحكم المسؤول</h1>
                <h2>إدارة المستخدمين والرصيد</h2>
            </div>
            
            <div class="admin-nav">
                <button class="admin-nav-btn active" id="adminUsersBtn">إدارة المستخدمين</button>
                <button class="admin-nav-btn" id="adminStatsBtn">الإحصائيات</button>
                <button class="admin-nav-btn" id="adminLogoutBtn">تسجيل الخروج</button>
            </div>
            
            <!-- قسم إدارة المستخدمين -->
            <div class="admin-section active" id="adminUsersSection">
                <h3>إدارة المستخدمين</h3>
                <div class="admin-stats">
                    <div class="stat-card">
                        <h4>إجمالي المستخدمين</h4>
                        <div class="value" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>المستخدمين النشطين</h4>
                        <div class="value" id="activeUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>المستخدمين المحظورين</h4>
                        <div class="value" id="bannedUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>إجمالي الرصيد</h4>
                        <div class="value" id="totalBalanceAdmin">$0</div>
                    </div>
                </div>
                
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>البريد الإلكتروني</th>
                            <th>كلمة المرور</th>
                            <th>تاريخ التسجيل</th>
                            <th>رصيد USDT</th>
                            <th>رصيد BTC</th>
                            <th>رصيد ETH</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- سيتم ملء هذا الجدول عبر JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- قسم الإحصائيات -->
            <div class="admin-section" id="adminStatsSection">
                <h3>إحصائيات النظام</h3>
                <div class="admin-stats">
                    <div class="stat-card">
                        <h4>إجمالي المعاملات</h4>
                        <div class="value" id="totalTransactions">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>إجمالي الإيداعات</h4>
                        <div class="value" id="totalDeposits">$0</div>
                    </div>
                    <div class="stat-card">
                        <h4>إجمالي السحوبات</h4>
                        <div class="value" id="totalWithdrawals">$0</div>
                    </div>
                    <div class="stat-card">
                        <h4>متوسط الرصيد</h4>
                        <div class="value" id="averageBalance">$0</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4 style="color: #ffd700; margin-bottom: 15px;">طلبات فتح VIP</h4>
                    <div id="vipRequestsList">
                        <!-- سيتم ملء هذا القسم عبر JavaScript -->
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4 style="color: #ffd700; margin-bottom: 15px;">طلبات السحب المعلقة</h4>
                    <div id="withdrawalRequestsList">
                        <!-- سيتم ملء هذا القسم عبر JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">تم نسخ العنوان إلى الحافظة</div>

    <script>
// تأكد من تحميل الـ DOM أولاً
document.addEventListener('DOMContentLoaded', function() {
    // كل الكود هنا
    initializePage();
});

// أو استخدم window.onload
window.onload = function() {
    initializePage();
};

// نظام تخزين البيانات المركزي
class DataManager {
    constructor() {
        this.storageKey = 'cryptoWalletData_v2';
        this.initData();
    }

    initData() {
        let data = localStorage.getItem(this.storageKey);
        if (!data) {
            data = {
                users: [],
                transactions: [],
                notifications: [],
                vipRequests: [],
                withdrawalRequests: [],
                depositRequests: [],
                referralStats: {},
                walletData: {
                    total: 0,
                    equivalent: "0.000000 BTC",
                    currencies: {
                        usdt: { amount: 0, value: 0 },
                        btc: { amount: 0, value: 0 },
                        eth: { amount: 0, value: 0 }
                    }
                },
                vipLevelsData: this.getDefaultVipLevels(),
                lastVipProfitDate: null,
                vipTimerEnd: Date.now() + (24 * 60 * 60 * 1000),
                currentUser: null
            };
            this.saveData(data);
        }
        return JSON.parse(data);
    }

    getDefaultVipLevels() {
        return [
            { level: 1, dailyTasks: 1, simpleInterest: 8.00, dailyProfit: 8.00, totalProfit: 1095.00, openPrice: 12.00, unlocked: false, active: false },
            { level: 2, dailyTasks: 1, simpleInterest: 20.00, dailyProfit: 20.00, totalProfit: 4745.00, openPrice: 52.00, unlocked: false, active: false },
            { level: 3, dailyTasks: 1, simpleInterest: 35.00, dailyProfit: 35.00, totalProfit: 9490.00, openPrice: 100.00, unlocked: false, active: false },
            { level: 4, dailyTasks: 1, simpleInterest: 100.00, dailyProfit: 100.00, totalProfit: 29930.00, openPrice: 300.00, unlocked: false, active: false },
            { level: 5, dailyTasks: 1, simpleInterest: 170.00, dailyProfit: 170.00, totalProfit: 52925.00, openPrice: 500.00, unlocked: false, active: false },
            { level: 6, dailyTasks: 1, simpleInterest: 500.00, dailyProfit: 500.00, totalProfit: 174835.00, openPrice: 1500.00, unlocked: false, active: false },
            { level: 7, dailyTasks: 1, simpleInterest: 1300.00, dailyProfit: 1300.00, totalProfit: 393470.00, openPrice: 3000.00, unlocked: false, active: false },
            { level: 8, dailyTasks: 1, simpleInterest: 2400.00, dailyProfit: 2400.00, totalProfit: 730000.00, openPrice: 5000.00, unlocked: false, active: false },
            { level: 9, dailyTasks: 1, simpleInterest: 4800.00, dailyProfit: 4800.00, totalProfit: 1659290.00, openPrice: 10000.00, unlocked: false, active: false },
            { level: 10, dailyTasks: 1, simpleInterest: 18500.00, dailyProfit: 18500.00, totalProfit: 6460135.00, openPrice: 30000.00, unlocked: false, active: false },
            { level: 11, dailyTasks: 1, simpleInterest: 83000.00, dailyProfit: 83000.00, totalProfit: 29863570.00, openPrice: 90000.00, unlocked: false, active: false }
        ];
    }

    getData() {
        return this.initData();
    }

    saveData(data) {
        localStorage.setItem(this.storageKey, JSON.stringify(data));
    }

    // دوال مساعدة للوصول إلى البيانات
    get users() {
        return this.getData().users;
    }

    set users(newUsers) {
        const data = this.getData();
        data.users = newUsers;
        this.saveData(data);
    }

    get transactions() {
        return this.getData().transactions;
    }

    set transactions(newTransactions) {
        const data = this.getData();
        data.transactions = newTransactions;
        this.saveData(data);
    }

    get notifications() {
        return this.getData().notifications;
    }

    set notifications(newNotifications) {
        const data = this.getData();
        data.notifications = newNotifications;
        this.saveData(data);
    }

    get vipRequests() {
        return this.getData().vipRequests;
    }

    set vipRequests(newVipRequests) {
        const data = this.getData();
        data.vipRequests = newVipRequests;
        this.saveData(data);
    }

    get withdrawalRequests() {
        return this.getData().withdrawalRequests;
    }

    set withdrawalRequests(newWithdrawalRequests) {
        const data = this.getData();
        data.withdrawalRequests = newWithdrawalRequests;
        this.saveData(data);
    }

    get depositRequests() {
        return this.getData().depositRequests;
    }

    set depositRequests(newDepositRequests) {
        const data = this.getData();
        data.depositRequests = newDepositRequests;
        this.saveData(data);
    }

    get walletData() {
        return this.getData().walletData;
    }

    set walletData(newWalletData) {
        const data = this.getData();
        data.walletData = newWalletData;
        this.saveData(data);
    }

    get vipLevelsData() {
        return this.getData().vipLevelsData;
    }

    set vipLevelsData(newVipLevelsData) {
        const data = this.getData();
        data.vipLevelsData = newVipLevelsData;
        this.saveData(data);
    }

    get lastVipProfitDate() {
        return this.getData().lastVipProfitDate;
    }

    set lastVipProfitDate(date) {
        const data = this.getData();
        data.lastVipProfitDate = date;
        this.saveData(data);
    }

    get vipTimerEnd() {
        return this.getData().vipTimerEnd;
    }

    set vipTimerEnd(time) {
        const data = this.getData();
        data.vipTimerEnd = time;
        this.saveData(data);
    }

    get currentUser() {
        return this.getData().currentUser;
    }

    set currentUser(user) {
        const data = this.getData();
        data.currentUser = user;
        this.saveData(data);
    }
}

// إنشاء مدير البيانات
const dataManager = new DataManager();

// بيانات المسؤول
const adminCredentials = {
    email: "admin@crypto.com",
    password: "admin123"
};

// عناوين لكل شبكة
const addresses = {
    'ERC20': '0x8574dE94D5DF925e8C9Db6282527Fd1539F9eD85',
    'TRC20': 'TN8rsodYN8HNnBum853uENLrDDXL6BDMHk',
    'SOL': 'Hwnc8ypNMFkpEH7JP1GXgHUaYAS5fPgUhPyrtmip2zim',
    'BEP20': '0x8574dE94D5DF925e8C9Db6282527Fd1539F9eD85',
    'BTC': 'bc1qyd3hk0cklrz4gqqkdlxj9gra3mw63wvxrvfqkm',
    'ETH': '0x8574dE94D5DF925e8C9Db6282527Fd1539F9eD85'
};

// معلومات لكل شبكة
const networkMessages = {
    'ERC20': 'فقط رمز USDT على شبكة ERC20 يُرسل إلى هذا العنوان',
    'TRC20': 'فقط رمز USDT على شبكة TRC20 يُرسل إلى هذا العنوان',
    'SOL': 'فقط رمز USDT على شبكة SOL يُرسل إلى هذا العنوان',
    'BEP20': 'فقط رمز USDT على شبكة BEP20 يُرسل إلى هذا العنوان',
    'BTC': 'فقط Bitcoin يُرسل إلى هذا العنوان',
    'ETH': 'فقط رمز USDT على شبكة ETH يُرسل إلى هذا العنوان'
};

// مؤقت VIP
let vipTimerInterval;
const VIP_TIMER_DURATION = 24 * 60 * 60 * 1000;

// عناصر DOM
const authContainer = document.getElementById('authContainer');
const walletContainer = document.getElementById('walletContainer');
const adminContainer = document.getElementById('adminContainer');
const registrationForm = document.getElementById('registrationForm');
const loginForm = document.getElementById('loginForm');
const showLoginBtn = document.getElementById('showLoginBtn');
const showRegisterBtn = document.getElementById('showRegisterBtn');
const successMessage = document.getElementById('successMessage');
const errorMessage = document.getElementById('errorMessage');
const loginErrorMessage = document.getElementById('loginErrorMessage');
const userEmailDisplay = document.getElementById('userEmailDisplay');
const userBtn = document.getElementById('userBtn');
const userDropdown = document.getElementById('userDropdown');
const logoutBtn = document.getElementById('logoutBtn');
const languageBtn = document.getElementById('languageBtn');
const languageDropdown = document.getElementById('languageDropdown');
const vipTimer = document.getElementById('vipTimer');
const balanceBtn = document.getElementById('balanceBtn');
const sendBtn = document.getElementById('sendBtn');
const receiveBtn = document.getElementById('receiveBtn');
const vipBtn = document.getElementById('vipBtn');
const referralNavBtn = document.getElementById('referralNavBtn');
const transactionsBtn = document.getElementById('transactionsBtn');
const walletSubtitle = document.getElementById('walletSubtitle');
const balanceCard = document.getElementById('balanceCard');
const currencyList = document.getElementById('currencyList');
const sendCard = document.getElementById('sendCard');
const transactionsCard = document.getElementById('transactionsCard');
const receiveCard = document.getElementById('receiveCard');
const vipCard = document.getElementById('vipCard');
const referralCard = document.getElementById('referralCard');
const vipLevels = document.getElementById('vipLevels');
const totalBalance = document.getElementById('totalBalance');
const balanceEquivalent = document.getElementById('balanceEquivalent');
const usdtAmount = document.getElementById('usdtAmount');
const usdtValue = document.getElementById('usdtValue');
const btcAmount = document.getElementById('btcAmount');
const btcValue = document.getElementById('btcValue');
const ethAmount = document.getElementById('ethAmount');
const ethValue = document.getElementById('ethValue');
const sendForm = document.getElementById('sendForm');
const cancelSend = document.getElementById('cancelSend');
const addressBox = document.getElementById('addressBox');
const copyBtn = document.getElementById('copyBtn');
const shareBtn = document.getElementById('shareBtn');
const toast = document.getElementById('toast');
const networkOptions = document.querySelectorAll('.network-option');
const networkInfo = document.getElementById('networkInfo');
const togglePassword = document.getElementById('togglePassword');
const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
const toggleLoginPassword = document.getElementById('toggleLoginPassword');
const transactionsList = document.getElementById('transactionsList');
const adminUsersBtn = document.getElementById('adminUsersBtn');
const adminStatsBtn = document.getElementById('adminStatsBtn');
const adminLogoutBtn = document.getElementById('adminLogoutBtn');
const adminUsersSection = document.getElementById('adminUsersSection');
const adminStatsSection = document.getElementById('adminStatsSection');
const usersTableBody = document.getElementById('usersTableBody');
const totalUsers = document.getElementById('totalUsers');
const activeUsers = document.getElementById('activeUsers');
const bannedUsers = document.getElementById('bannedUsers');
const totalBalanceAdmin = document.getElementById('totalBalanceAdmin');
const totalTransactions = document.getElementById('totalTransactions');
const totalDeposits = document.getElementById('totalDeposits');
const totalWithdrawals = document.getElementById('totalWithdrawals');
const averageBalance = document.getElementById('averageBalance');
const vipRequestsList = document.getElementById('vipRequestsList');
const withdrawalRequestsList = document.getElementById('withdrawalRequestsList');
const referralCodeDisplay = document.getElementById('referralCodeDisplay');
const referralLinkDisplay = document.getElementById('referralLinkDisplay');
const copyReferralCode = document.getElementById('copyReferralCode');
const copyReferralLinkFull = document.getElementById('copyReferralLinkFull');

// ========== دوال إدارة المستخدمين والإيداعات ==========

// الحصول على الإيداعات المعلقة
function getPendingDeposits() {
    return dataManager.depositRequests.filter(d => d.status === 'معلق');
}

// الحصول على السحوبات المعلقة
function getPendingWithdrawals() {
    return dataManager.withdrawalRequests.filter(w => w.status === 'معلق');
}

// الحصول على مبالغ الإيداعات لكل مستخدم
function getDepositAmounts() {
    const deposits = dataManager.transactions.filter(t => t.type === 'receive' && t.status === 'مكتمل');
    const amounts = {};
    
    deposits.forEach(deposit => {
        const user = deposit.userEmail || dataManager.currentUser || 'غير معروف';
        if (!amounts[user]) amounts[user] = 0;
        
        const amount = parseFloat(deposit.amount.replace(/[^0-9.-]/g, ''));
        amounts[user] += amount;
    });
    
    return amounts;
}

// الحصول على إحصائيات الإيداعات للمسؤول
function getAdminDepositStats() {
    const deposits = dataManager.transactions.filter(t => t.type === 'receive' && t.status === 'مكتمل');
    const stats = {
        totalDeposits: 0,
        pendingDeposits: getPendingDeposits().length,
        userDeposits: {}
    };
    
    deposits.forEach(deposit => {
        const amount = parseFloat(deposit.amount.replace(/[^0-9.-]/g, ''));
        stats.totalDeposits += amount;
        
        const user = deposit.userEmail || dataManager.currentUser || 'غير معروف';
        if (!stats.userDeposits[user]) {
            stats.userDeposits[user] = 0;
        }
        stats.userDeposits[user] += amount;
    });
    
    return stats;
}

// ========== نظام الإحالة المحسن ==========

// معالجة مكافآت الإحالة
function handleReferralBonus(newUserEmail, referrerCode) {
    if (!referrerCode) return;
    
    const referrer = dataManager.users.find(user => user.referralCode === referrerCode);
    if (!referrer) return;
    
    // تحديث إحصائيات الإحالة
    if (!referrer.referralStats) {
        referrer.referralStats = {
            totalReferrals: 0,
            activeReferrals: 0,
            totalCommission: 0,
            level1Commission: 0,
            level2Commission: 0
        };
    }
    
    referrer.referralStats.totalReferrals++;
    referrer.referralStats.activeReferrals++;
    
    // لا نعطي رصيد مجاني للمستخدم الجديد
    // ولكن نسجل الإحالة للمكافآت المستقبلية
    
    // إضافة إشعار للمدعو
    addNotification('تم التسجيل بنجاح', 'مرحباً بك في محفظة العملات المشفرة الأمريكية', 'الآن', newUserEmail);
    
    // إضافة إشعار للمدعو
    addNotification('إحالة جديدة', `قام ${newUserEmail} بالتسجيل عبر رابط إحالتك`, 'الآن', referrer.email);
    
    dataManager.users = [...dataManager.users];
}

// تحديث إحصائيات الإحالة
function updateReferralStats() {
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    if (!currentUserData) return;
    
    const referralCode = currentUserData.referralCode;
    
    // حساب عدد المستخدمين المسجلين عبر رابط الإحالة
    const referredUsers = dataManager.users.filter(user => user.referredBy === referralCode);
    const newReferredUsers = referredUsers.filter(user => {
        const registrationDate = new Date(user.registrationDate);
        const today = new Date();
        const diffTime = Math.abs(today - registrationDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays <= 30;
    });
    
    // تحديث رابط الإحالة
    referralLinkDisplay.textContent = `https://american-html.vercel.app/#/register?ref=${referralCode}`;
    
    // تحديث إحصائيات الإحالة
    const referralStatValues = document.querySelectorAll('.referral-stat-value');
    if (referralStatValues.length >= 4) {
        referralStatValues[0].textContent = `$${referredUsers.length * 10}`;
        referralStatValues[1].textContent = `$${referredUsers.length * 5}`;
        referralStatValues[2].textContent = referredUsers.length;
        referralStatValues[3].textContent = newReferredUsers.length;
    }
    
    // تحديث عمولات الإحالة
    const commissionLevels = document.querySelectorAll('.commission-level');
    if (commissionLevels.length >= 2) {
        commissionLevels[0].querySelector('.commission-stats').innerHTML = 
            `<span>مسجل / صالح: ${referredUsers.length}/${referredUsers.length}</span>
             <span>إجمالي الدخل: $${referredUsers.length * 6}</span>`;
        
        commissionLevels[1].querySelector('.commission-stats').innerHTML = 
            `<span>مسجل / صالح: ${referredUsers.length}/${referredUsers.length}</span>
             <span>إجمالي الدخل: $${referredUsers.length * 2}</span>`;
    }
}

// ========== نظام VIP المحسن ==========

// تحديث عرض مستويات VIP
function updateVipLevelsDisplay() {
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    const userBalance = currentUserData ? (currentUserData.balance?.usdt || 0) : 0;
    
    vipLevels.innerHTML = dataManager.vipLevelsData.map(level => {
        const isUnlocked = level.unlocked;
        const isActive = level.active;
        const hasEnoughBalance = userBalance >= level.openPrice;
        const canUnlock = !isUnlocked && hasEnoughBalance;
        
        let statusText = '';
        let statusClass = '';
        
        if (isActive) {
            statusText = 'نشط';
            statusClass = 'active';
        } else if (isUnlocked) {
            statusText = 'مفتوح';
            statusClass = 'pending';
        } else {
            statusText = 'مقفل';
            statusClass = 'locked';
        }
        
        return `
        <div class="vip-level ${isUnlocked ? 'unlocked' : 'locked'}">
            <div class="vip-lock">
                <i class="fas ${isUnlocked ? 'fa-unlock' : 'fa-lock'}"></i>
            </div>
            
            <div class="vip-level-header">
                <div class="vip-level-title">VIP${level.level}</div>
                <div class="vip-level-img">VIP</div>
            </div>
            
            <div class="vip-details">
                <div class="vip-detail">
                    <div class="vip-detail-label">مهمات يوميه</div>
                    <div class="vip-detail-value">${level.dailyTasks}</div>
                </div>
                <div class="vip-detail">
                    <div class="vip-detail-label">مصلحة بسيطة</div>
                    <div class="vip-detail-value">${level.simpleInterest.toFixed(2)}</div>
                </div>
            </div>
            
            <div class="vip-profit">
                <div class="vip-profit-item">
                    <div class="vip-profit-label">الربح اليومي</div>
                    <div class="vip-profit-value">${level.dailyProfit.toFixed(2)} USDT</div>
                </div>
                <div class="vip-profit-item">
                    <div class="vip-profit-label">إجمالي الربح</div>
                    <div class="vip-profit-value">${level.totalProfit.toLocaleString()} USDT</div>
                </div>
            </div>
            
            <div class="vip-status ${statusClass}">
                ${statusText}
            </div>
            
            <button class="vip-open-btn ${!canUnlock && !isUnlocked ? 'disabled' : ''} ${isUnlocked ? 'success' : ''}" 
                    onclick="handleVipLevel(${level.level})"
                    ${!canUnlock && !isUnlocked ? 'disabled' : ''}>
                ${isUnlocked ? 
                    '<i class="fas fa-check"></i> مفتوح' : 
                    `${level.openPrice.toLocaleString()} USDT افتح الآن`
                }
            </button>
            
            ${!hasEnoughBalance && !isUnlocked ? 
                `<div style="text-align: center; margin-top: 8px; font-size: 0.8rem; color: #ff6666;">
                    الرصيد غير كافي
                </div>` : 
                ''
            }
        </div>
        `;
    }).join('');
}

// معالجة فتح مستوى VIP
function handleVipLevel(levelNumber) {
    const levelIndex = dataManager.vipLevelsData.findIndex(level => level.level === levelNumber);
    if (levelIndex === -1) return;
    
    const level = dataManager.vipLevelsData[levelIndex];
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    
    if (!currentUserData) {
        showToast('يجب تسجيل الدخول أولاً');
        return;
    }
    
    if (level.unlocked) {
        showToast(`مستوى VIP${level.level} مفتوح بالفعل`);
        return;
    }
    
    if ((currentUserData.balance?.usdt || 0) < level.openPrice) {
        showToast('الرصيد غير كافي لفتح هذا المستوى');
        return;
    }
    
    openVipLevel(levelIndex);
}

// فتح مستوى VIP
function openVipLevel(levelIndex) {
    const level = dataManager.vipLevelsData[levelIndex];
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    
    if (!currentUserData) return;
    
    // خصم المبلغ من رصيد المستخدم
    if (!currentUserData.balance) currentUserData.balance = { usdt: 0, btc: 0, eth: 0 };
    currentUserData.balance.usdt -= level.openPrice;
    level.unlocked = true;
    level.active = true;
    
    dataManager.users = [...dataManager.users];
    dataManager.vipLevelsData = [...dataManager.vipLevelsData];
    
    // منح الربح اليومي فوراً
    currentUserData.balance.usdt += level.dailyProfit;
    
    // إرسال تفاصيل الفتح إلى المسؤول
    const vipRequest = {
        id: 'VIP-' + Date.now(),
        userEmail: dataManager.currentUser,
        level: level.level,
        amount: level.openPrice,
        status: 'مكتمل',
        date: new Date().toLocaleDateString('ar-EG'),
        timestamp: new Date().toISOString()
    };
    
    dataManager.vipRequests = [vipRequest, ...dataManager.vipRequests];
    
    const transaction = {
        id: 'VIP-' + Date.now(),
        type: 'send',
        description: `فتح VIP${level.level}`,
        amount: `-${level.openPrice} USDT`,
        value: `$${level.openPrice.toLocaleString()}`,
        date: new Date().toLocaleDateString('ar-EG'),
        status: 'مكتمل',
        timestamp: new Date().toISOString()
    };
    
    // إضافة معاملة الربح اليومي
    const profitTransaction = {
        id: 'VIP-PROFIT-' + Date.now(),
        type: 'receive',
        description: `ربح يومي VIP${level.level}`,
        amount: `+${level.dailyProfit} USDT`,
        value: `$${level.dailyProfit.toLocaleString()}`,
        date: new Date().toLocaleDateString('ar-EG'),
        status: 'مكتمل',
        timestamp: new Date().toISOString()
    };
    
    dataManager.transactions = [transaction, profitTransaction, ...dataManager.transactions];
    
    updateBalanceDisplay();
    updateVipLevelsDisplay();
    updateTransactionsDisplay();
    
    addNotification(`تم فتح VIP${level.level}`, `تم فتح مستوى VIP${level.level} بنجاح وحصلت على ${level.dailyProfit} USDT ربح يومي`, 'الآن');
    showToast(`تم فتح مستوى VIP${level.level} بنجاح! وحصلت على ربح يومي فوري`);
}

// حساب أرباح VIP اليومية
function calculateDailyVipProfits() {
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    if (!currentUserData) return;
    
    let totalDailyProfit = 0;
    let activeLevels = 0;
    
    dataManager.vipLevelsData.forEach(level => {
        if (level.active) {
            totalDailyProfit += level.dailyProfit;
            activeLevels++;
            
            // إضافة معاملة الربح اليومي
            const transaction = {
                id: 'VIP-PROFIT-' + Date.now() + '-' + level.level,
                type: 'receive',
                description: `ربح يومي VIP${level.level}`,
                amount: `+${level.dailyProfit} USDT`,
                value: `$${level.dailyProfit.toLocaleString()}`,
                date: new Date().toLocaleDateString('ar-EG'),
                status: 'مكتمل',
                timestamp: new Date().toISOString()
            };
            
            dataManager.transactions = [transaction, ...dataManager.transactions];
        }
    });
    
    if (totalDailyProfit > 0) {
        if (!currentUserData.balance) currentUserData.balance = { usdt: 0, btc: 0, eth: 0 };
        currentUserData.balance.usdt += totalDailyProfit;
        dataManager.users = [...dataManager.users];
        
        updateBalanceDisplay();
        updateTransactionsDisplay();
        
        if (activeLevels > 0) {
            addNotification('أرباح VIP', `تم إضافة ${totalDailyProfit.toFixed(2)} USDT إلى رصيدك كأرباح يومية من ${activeLevels} مستويات VIP نشطة`, 'الآن');
        }
    }
}

// فحص الأرباح اليومية
function checkDailyVipProfits() {
    const lastProfitDate = dataManager.lastVipProfitDate;
    const today = new Date().toDateString();
    
    if (lastProfitDate !== today) {
        calculateDailyVipProfits();
        dataManager.lastVipProfitDate = today;
    }
}

// ========== نظام الإيداع مع عمولات الإحالة ==========

// معالجة الإيداع
function handleDeposit(userEmail, amount, currency = 'USDT') {
    const user = dataManager.users.find(u => u.email === userEmail);
    if (!user) return false;
    
    // إضافة الرصيد للمستخدم
    if (!user.balance) user.balance = { usdt: 0, btc: 0, eth: 0 };
    user.balance[currency.toLowerCase()] += amount;
    
    // معالجة عمولات الإحالة
    if (user.referredBy) {
        const referrer = dataManager.users.find(u => u.referralCode === user.referredBy);
        if (referrer) {
            const commission = amount * 0.06;
            
            if (!referrer.balance) referrer.balance = { usdt: 0, btc: 0, eth: 0 };
            referrer.balance.usdt += commission;
            
            // تحديث إحصائيات الإحالة
            if (!referrer.referralStats) {
                referrer.referralStats = {
                    totalReferrals: 0,
                    activeReferrals: 0,
                    totalCommission: 0,
                    level1Commission: 0,
                    level2Commission: 0
                };
            }
            
            referrer.referralStats.totalCommission += commission;
            referrer.referralStats.level1Commission += commission;
            
            // إضافة معاملة العمولة
            const commissionTransaction = {
                id: 'COMM-' + Date.now(),
                type: 'receive',
                description: `عمولة إحالة من ${userEmail}`,
                amount: `+${commission} USDT`,
                value: `$${commission.toLocaleString()}`,
                date: new Date().toLocaleDateString('ar-EG'),
                status: 'مكتمل',
                timestamp: new Date().toISOString()
            };
            
            dataManager.transactions = [commissionTransaction, ...dataManager.transactions];
            
            addNotification('عمولة إحالة', `حصلت على ${commission} USDT عمولة إحالة من ${userEmail}`, 'الآن', referrer.email);
        }
        
        // المستوى الثاني من الإحالة (2%)
        if (referrer && referrer.referredBy) {
            const level2Referrer = dataManager.users.find(u => u.referralCode === referrer.referredBy);
            if (level2Referrer) {
                const level2Commission = amount * 0.02;
                
                if (!level2Referrer.balance) level2Referrer.balance = { usdt: 0, btc: 0, eth: 0 };
                level2Referrer.balance.usdt += level2Commission;
                
                if (!level2Referrer.referralStats) {
                    level2Referrer.referralStats = {
                        totalReferrals: 0,
                        activeReferrals: 0,
                        totalCommission: 0,
                        level1Commission: 0,
                        level2Commission: 0
                    };
                }
                
                level2Referrer.referralStats.totalCommission += level2Commission;
                level2Referrer.referralStats.level2Commission += level2Commission;
                
                // إضافة معاملة العمولة للمستوى الثاني
                const level2Transaction = {
                    id: 'COMM-L2-' + Date.now(),
                    type: 'receive',
                    description: `عمولة إحالة مستوى ثاني من ${userEmail}`,
                    amount: `+${level2Commission} USDT`,
                    value: `$${level2Commission.toLocaleString()}`,
                    date: new Date().toLocaleDateString('ar-EG'),
                    status: 'مكتمل',
                    timestamp: new Date().toISOString()
                };
                
                dataManager.transactions = [level2Transaction, ...dataManager.transactions];
                
                addNotification('عمولة إحالة مستوى ثاني', `حصلت على ${level2Commission} USDT عمولة إحالة مستوى ثاني من ${userEmail}`, 'الآن', level2Referrer.email);
            }
        }
    }
    
    // إضافة معاملة الإيداع
    const depositTransaction = {
        id: 'DEP-' + Date.now(),
        type: 'receive',
        description: `إيداع ${currency}`,
        amount: `+${amount} ${currency}`,
        value: `$${amount.toLocaleString()}`,
        date: new Date().toLocaleDateString('ar-EG'),
        status: 'مكتمل',
        timestamp: new Date().toISOString()
    };
    
    dataManager.transactions = [depositTransaction, ...dataManager.transactions];
    
    addNotification('إيداع ناجح', `تم إيداع ${amount} ${currency} إلى حسابك`, 'الآن', userEmail);
    
    return true;
}

// ========== دوال المحفظة الأساسية ==========

// تحديث عرض الرصيد
function updateBalanceDisplay() {
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    
    if (currentUserData && currentUserData.balance) {
        dataManager.walletData.currencies.usdt.amount = currentUserData.balance.usdt || 0;
        dataManager.walletData.currencies.btc.amount = currentUserData.balance.btc || 0;
        dataManager.walletData.currencies.eth.amount = currentUserData.balance.eth || 0;
        
        dataManager.walletData.currencies.usdt.value = dataManager.walletData.currencies.usdt.amount * 1;
        dataManager.walletData.currencies.btc.value = dataManager.walletData.currencies.btc.amount * 50000;
        dataManager.walletData.currencies.eth.value = dataManager.walletData.currencies.eth.amount * 3000;
        
        dataManager.walletData.total = dataManager.walletData.currencies.usdt.value + dataManager.walletData.currencies.btc.value + dataManager.walletData.currencies.eth.value;
        dataManager.walletData.equivalent = `${dataManager.walletData.currencies.btc.amount.toFixed(6)} BTC`;
    }
    
    totalBalance.textContent = `$${dataManager.walletData.total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    balanceEquivalent.textContent = `≈ ${dataManager.walletData.equivalent}`;
    
    usdtAmount.textContent = `${dataManager.walletData.currencies.usdt.amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} USDT`;
    usdtValue.textContent = `$${dataManager.walletData.currencies.usdt.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    
    btcAmount.textContent = `${dataManager.walletData.currencies.btc.amount.toFixed(6)} BTC`;
    btcValue.textContent = `$${dataManager.walletData.currencies.btc.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    
    ethAmount.textContent = `${dataManager.walletData.currencies.eth.amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} ETH`;
    ethValue.textContent = `$${dataManager.walletData.currencies.eth.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
}

// تحديث عرض المعاملات
function updateTransactionsDisplay() {
    if (dataManager.transactions.length === 0) {
        transactionsList.innerHTML = `
            <div class="no-transactions">
                <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                <p>لا توجد معاملات حتى الآن</p>
                <small>سيظهر سجل المعاملات هنا بعد إجراء أول عملية</small>
            </div>
        `;
        return;
    }
    
    transactionsList.innerHTML = dataManager.transactions.map(transaction => `
        <div class="transaction-item" data-transaction-id="${transaction.id}">
            <div class="transaction-info">
                <div class="transaction-icon ${transaction.type}">
                    <i class="fas fa-${transaction.type === 'receive' ? 'arrow-down' : 'arrow-up'}"></i>
                </div>
                <div class="transaction-details">
                    <h3>${transaction.description}</h3>
                    <span>${transaction.date} • <span class="transaction-status" style="color: ${transaction.status === 'مكتمل' ? '#00cc00' : '#ffd700'}">${transaction.status}</span></span>
                </div>
            </div>
            <div class="transaction-amount ${transaction.type}">
                <div class="amount">${transaction.amount}</div>
                <div class="value">${transaction.value}</div>
            </div>
        </div>
    `).join('');
}

// ========== نظام المؤقت المحسن ==========

// بدء مؤقت VIP
function startVipTimer() {
    let endTime = dataManager.vipTimerEnd;
    
    if (!endTime) {
        endTime = Date.now() + VIP_TIMER_DURATION;
        dataManager.vipTimerEnd = endTime;
    }
    
    updateVipTimer();
    
    vipTimerInterval = setInterval(() => {
        updateVipTimer();
        checkDailyVipProfits();
    }, 1000);
}

// تحديث مؤقت VIP
function updateVipTimer() {
    const endTime = dataManager.vipTimerEnd;
    const now = Date.now();
    const remainingTime = endTime - now;
    
    if (remainingTime <= 0) {
        vipTimer.textContent = '00:00:00';
        dataManager.vipTimerEnd = Date.now() + VIP_TIMER_DURATION;
        
        // تجديد الأرباح اليومية عند انتهاء المؤقت
        calculateDailyVipProfits();
        addNotification('تم تجديد المؤقت', 'تم تجديد المؤقت اليومي بنجاح وحصلت على أرباحك اليومية!', 'الآن');
        return;
    }
    
    const hours = Math.floor(remainingTime / (1000 * 60 * 60));
    const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
    
    vipTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// ========== دوال التسجيل والدخول المحسنة ==========

// توليد كود إحالة
function generateReferralCode() {
    return Math.floor(100000 + Math.random() * 900000).toString();
}

// معالجة التسجيل
function handleRegistration() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const invitationCode = document.getElementById('invitationCode').value;
    
    showLoading();
    
    if (password !== confirmPassword) {
        hideLoading();
        showError('كلمات المرور غير متطابقة. يرجى المحاولة مرة أخرى.');
        return;
    }
    
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        hideLoading();
        showError('يرجى إدخال بريد إلكتروني صحيح.');
        return;
    }
    
    if (password.length < 6) {
        hideLoading();
        showError('كلمة المرور يجب أن تكون 6 أحرف على الأقل.');
        return;
    }
    
    if (dataManager.users.find(user => user.email === email)) {
        hideLoading();
        showError('هذا البريد الإلكتروني مسجل بالفعل. يرجى استخدام بريد إلكتروني آخر.');
        return;
    }
    
    setTimeout(() => {
        const newUser = {
            email: email,
            password: password,
            registrationDate: new Date().toISOString(),
            balance: {
                usdt: 0,
                btc: 0,
                eth: 0
            },
            isBanned: false,
            referralCode: generateReferralCode(),
            referredBy: invitationCode,
            referralStats: {
                totalReferrals: 0,
                activeReferrals: 0,
                totalCommission: 0,
                level1Commission: 0,
                level2Commission: 0
            },
            vipLevels: dataManager.getDefaultVipLevels().map(level => ({
                ...level,
                unlocked: false,
                active: false
            }))
        };
        
        dataManager.users = [...dataManager.users, newUser];
        dataManager.currentUser = email;
        
        // معالجة الإحالة بدون إعطاء رصيد مجاني
        handleReferralBonus(email, invitationCode);
        
        hideLoading();
        successMessage.style.display = 'block';
        
        addNotification('مرحباً بك!', 'تم إنشاء حسابك بنجاح. ابدأ باستكشاف ميزات المحفظة.', 'الآن');
        
        setTimeout(function() {
            showWalletInterface();
            userEmailDisplay.textContent = email;
        }, 2000);
    }, 1500);
}

// معالجة تسجيل الدخول
function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (email === adminCredentials.email && password === adminCredentials.password) {
        showAdminInterface();
        return;
    }
    
    const user = dataManager.users.find(user => user.email === email && user.password === password);
    
    if (user) {
        if (user.isBanned) {
            showLoginError('هذا الحساب محظور. يرجى التواصل مع الدعم.');
            return;
        }
        
        dataManager.currentUser = email;
        showWalletInterface();
        userEmailDisplay.textContent = email;
    } else {
        showLoginError('البريد الإلكتروني أو كلمة المرور غير صحيحة. يرجى المحاولة مرة أخرى.');
    }
}

// ========== دوال المعاملات ==========

// معالجة معاملة السحب
function handleSendTransaction() {
    const currency = document.getElementById('sendCurrency').value;
    const address = document.getElementById('sendAddress').value;
    const amount = parseFloat(document.getElementById('sendAmount').value);
    const network = document.getElementById('sendNetwork').value;
    
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    if (!currentUserData) {
        showError('يجب تسجيل الدخول أولاً');
        return;
    }
    
    let hasBalance = false;
    
    switch(currency) {
        case 'USDT':
            hasBalance = (currentUserData.balance?.usdt || 0) >= amount;
            break;
        case 'BTC':
            hasBalance = (currentUserData.balance?.btc || 0) >= amount;
            break;
        case 'ETH':
            hasBalance = (currentUserData.balance?.eth || 0) >= amount;
            break;
    }
    
    if (!hasBalance) {
        showError('لا يوجد رصيد كافي للسحب');
        return;
    }
    
    if (amount <= 0) {
        showError('يرجى إدخال مبلغ صحيح');
        return;
    }
    
    if (!address) {
        showError('يرجى إدخال عنوان المحفظة');
        return;
    }
    
    if (address.length < 10) {
        showError('عنوان المحفظة غير صحيح');
        return;
    }
    
    showLoading();
    
    setTimeout(() => {
        // خصم المبلغ من رصيد المستخدم فوراً
        if (!currentUserData.balance) currentUserData.balance = { usdt: 0, btc: 0, eth: 0 };
        
        switch(currency) {
            case 'USDT':
                currentUserData.balance.usdt -= amount;
                break;
            case 'BTC':
                currentUserData.balance.btc -= amount;
                break;
            case 'ETH':
                currentUserData.balance.eth -= amount;
                break;
        }
        
        dataManager.users = [...dataManager.users];
        
        const transactionId = 'TX' + Date.now();
        const transaction = {
            id: transactionId,
            type: 'send',
            description: `سحب ${currency}`,
            amount: `-${amount} ${currency}`,
            value: `$${(amount * 1).toLocaleString()}`,
            date: new Date().toLocaleDateString('ar-EG'),
            status: 'قيد المعالجة',
            currency: currency,
            address: address,
            network: network,
            timestamp: new Date().toISOString()
        };
        
        dataManager.transactions = [transaction, ...dataManager.transactions];
        
        const withdrawalRequest = {
            id: 'WDR-' + Date.now(),
            userEmail: dataManager.currentUser,
            currency: currency,
            amount: amount,
            address: address,
            network: network,
            status: 'معلق',
            date: new Date().toLocaleDateString('ar-EG'),
            timestamp: new Date().toISOString()
        };
        
        dataManager.withdrawalRequests = [withdrawalRequest, ...dataManager.withdrawalRequests];
        
        addNotification(`تم بدء سحب ${currency}`, `جاري معالجة سحب ${amount} ${currency}`, 'الآن');
        
        updateBalanceDisplay();
        updateTransactionsDisplay();
        hideLoading();
        showToast('تم بدء معالجة المعاملة! سيتم مراجعتها من قبل المسؤول');
        showBalanceSection();
        sendForm.reset();
    }, 2000);
}

// ========== دوال المساعدين ==========

// نسخ إلى الحافظة
function copyToClipboard(text) {
    if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('تم نسخ الرابط إلى الحافظة');
        }).catch(err => {
            fallbackCopyToClipboard(text);
        });
    } else {
        fallbackCopyToClipboard(text);
    }
}

// نسخ احتياطي إلى الحافظة
function fallbackCopyToClipboard(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showToast('تم نسخ الرابط إلى الحافظة');
}

// عرض رسالة toast
function showToast(message = 'تم النسخ إلى الحافظة') {
    toast.textContent = message;
    toast.style.display = 'block';
    setTimeout(() => {
        toast.style.display = 'none';
    }, 2000);
}

// عرض مؤشر التحميل
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

// إخفاء مؤشر التحميل
function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// عرض خطأ
function showError(message) {
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
    setTimeout(() => {
        errorMessage.style.display = 'none';
    }, 5000);
}

// عرض خطأ تسجيل الدخول
function showLoginError(message) {
    loginErrorMessage.textContent = message;
    loginErrorMessage.style.display = 'block';
    setTimeout(() => {
        loginErrorMessage.style.display = 'none';
    }, 5000);
}

// إضافة إشعار
function addNotification(title, message, time, userEmail = dataManager.currentUser) {
    const notification = {
        id: Date.now(),
        title: title,
        message: message,
        time: time,
        read: false,
        userEmail: userEmail
    };
    
    dataManager.notifications = [notification, ...dataManager.notifications];
}

// تبديل رؤية كلمة المرور
function togglePasswordVisibility(passwordInput, toggleButton) {
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
    } else {
        passwordInput.type = 'password';
        toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
    }
}

// ========== دوال التنقل ==========

// عرض قسم الرصيد
function showBalanceSection() {
    resetNavButtons();
    balanceBtn.classList.add('active');
    walletSubtitle.textContent = 'الرصيد';
    balanceCard.style.display = 'block';
    currencyList.style.display = 'block';
    sendCard.style.display = 'none';
    transactionsCard.style.display = 'none';
    receiveCard.style.display = 'none';
    vipCard.style.display = 'none';
    referralCard.style.display = 'none';
}

// عرض قسم السحب
function showSendSection() {
    resetNavButtons();
    sendBtn.classList.add('active');
    walletSubtitle.textContent = 'سحب الأموال';
    sendCard.style.display = 'block';
    balanceCard.style.display = 'none';
    currencyList.style.display = 'none';
    transactionsCard.style.display = 'none';
    receiveCard.style.display = 'none';
    vipCard.style.display = 'none';
    referralCard.style.display = 'none';
}

// عرض قسم التعبئة
function showReceiveSection() {
    resetNavButtons();
    receiveBtn.classList.add('active');
    walletSubtitle.textContent = 'تعبئة الرصيد';
    receiveCard.style.display = 'block';
    balanceCard.style.display = 'none';
    currencyList.style.display = 'none';
    sendCard.style.display = 'none';
    transactionsCard.style.display = 'none';
    vipCard.style.display = 'none';
    referralCard.style.display = 'none';
}

// عرض قسم VIP
function showVipSection() {
    resetNavButtons();
    vipBtn.classList.add('active');
    walletSubtitle.textContent = 'كبار الشخصيات VIP';
    updateVipLevelsDisplay();
    vipCard.style.display = 'block';
    balanceCard.style.display = 'none';
    currencyList.style.display = 'none';
    sendCard.style.display = 'none';
    transactionsCard.style.display = 'none';
    receiveCard.style.display = 'none';
    referralCard.style.display = 'none';
}

// عرض قسم الإحالة
function showReferralSection() {
    resetNavButtons();
    referralNavBtn.classList.add('active');
    walletSubtitle.textContent = 'نظام الإحالة';
    
    // تحديث بيانات الإحالة للمستخدم الحالي
    const currentUserData = dataManager.users.find(user => user.email === dataManager.currentUser);
    if (currentUserData) {
        referralCodeDisplay.textContent = currentUserData.referralCode;
        updateReferralStats();
    }
    
    referralCard.style.display = 'block';
    balanceCard.style.display = 'none';
    currencyList.style.display = 'none';
    sendCard.style.display = 'none';
    transactionsCard.style.display = 'none';
    receiveCard.style.display = 'none';
    vipCard.style.display = 'none';
}

// عرض قسم المعاملات
function showTransactionsSection() {
    resetNavButtons();
    transactionsBtn.classList.add('active');
    walletSubtitle.textContent = 'سجل المعاملات';
    transactionsCard.style.display = 'block';
    balanceCard.style.display = 'none';
    currencyList.style.display = 'none';
    sendCard.style.display = 'none';
    receiveCard.style.display = 'none';
    vipCard.style.display = 'none';
    referralCard.style.display = 'none';
}

// إعادة تعيين أزرار التنقل
function resetNavButtons() {
    balanceBtn.classList.remove('active');
    sendBtn.classList.remove('active');
    receiveBtn.classList.remove('active');
    vipBtn.classList.remove('active');
    referralNavBtn.classList.remove('active');
    transactionsBtn.classList.remove('active');
}

// ========== دوال واجهة المستخدم ==========

// عرض نموذج تسجيل الدخول
function showLoginForm() {
    registrationForm.style.display = 'none';
    loginForm.style.display = 'block';
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
}

// عرض نموذج التسجيل
function showRegisterForm() {
    loginForm.style.display = 'none';
    registrationForm.style.display = 'block';
    loginErrorMessage.style.display = 'none';
    successMessage.style.display = 'none';
}

// عرض واجهة المحفظة
function showWalletInterface() {
    authContainer.style.display = 'none';
    walletContainer.style.display = 'block';
    adminContainer.style.display = 'none';
    updateBalanceDisplay();
    showBalanceSection();
}

// تسجيل الخروج
function handleLogout() {
    dataManager.currentUser = null;
    walletContainer.style.display = 'none';
    authContainer.style.display = 'flex';
    showRegisterForm();
    registrationForm.reset();
    loginForm.reset();
    userDropdown.classList.remove('show');
    
    if (vipTimerInterval) {
        clearInterval(vipTimerInterval);
    }
}

// ========== دوال لوحة المسؤول ==========

// عرض واجهة المسؤول
function showAdminInterface() {
    authContainer.style.display = 'none';
    walletContainer.style.display = 'none';
    adminContainer.style.display = 'block';
    updateAdminUsersTable();
    updateAdminStats();
}

// عرض قسم إدارة المستخدمين في المسؤول
function showAdminUsersSection() {
    adminUsersBtn.classList.add('active');
    adminStatsBtn.classList.remove('active');
    adminUsersSection.classList.add('active');
    adminStatsSection.classList.remove('active');
}

// عرض قسم الإحصائيات في المسؤول
function showAdminStatsSection() {
    adminStatsBtn.classList.add('active');
    adminUsersBtn.classList.remove('active');
    adminStatsSection.classList.add('active');
    adminUsersSection.classList.remove('active');
}

// تسجيل خروج المسؤول
function handleAdminLogout() {
    adminContainer.style.display = 'none';
    authContainer.style.display = 'flex';
    showLoginForm();
}

// تحديث جدول المستخدمين في المسؤول
function updateAdminUsersTable() {
    usersTableBody.innerHTML = '';
    
    dataManager.users.forEach((user, index) => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>${user.email}</td>
            <td>${user.password}</td>
            <td>${new Date(user.registrationDate).toLocaleDateString('ar-EG')}</td>
            <td>
                <span>${user.balance?.usdt || 0} USDT</span>
                <div class="balance-form">
                    <input type="number" id="usdt-${index}" placeholder="المبلغ">
                    <button onclick="addBalance(${index}, 'usdt')">+</button>
                    <button onclick="withdrawBalance(${index}, 'usdt')">-</button>
                </div>
            </td>
            <td>
                <span>${user.balance?.btc || 0} BTC</span>
                <div class="balance-form">
                    <input type="number" id="btc-${index}" placeholder="المبلغ">
                    <button onclick="addBalance(${index}, 'btc')">+</button>
                    <button onclick="withdrawBalance(${index}, 'btc')">-</button>
                </div>
            </td>
            <td>
                <span>${user.balance?.eth || 0} ETH</span>
                <div class="balance-form">
                    <input type="number" id="eth-${index}" placeholder="المبلغ">
                    <button onclick="addBalance(${index}, 'eth')">+</button>
                    <button onclick="withdrawBalance(${index}, 'eth')">-</button>
                </div>
            </td>
            <td class="${user.isBanned ? 'user-banned' : ''}">
                ${user.isBanned ? 'محظور' : 'نشط'}
            </td>
            <td>
                ${user.isBanned ? 
                    `<button class="action-btn unban-user-btn" onclick="unbanUser(${index})">رفع الحظر</button>` : 
                    `<button class="action-btn ban-user-btn" onclick="banUser(${index})">حظر</button>`
                }
                <button class="action-btn withdraw-balance-btn" onclick="withdrawAllBalance(${index})">سحب الكل</button>
            </td>
        `;
        
        usersTableBody.appendChild(row);
    });
    
    updateAdminStats();
}

// تحديث إحصائيات المسؤول
function updateAdminStats() {
    totalUsers.textContent = dataManager.users.length;
    activeUsers.textContent = dataManager.users.filter(user => !user.isBanned).length;
    bannedUsers.textContent = dataManager.users.filter(user => user.isBanned).length;
    
    let totalBalanceValue = 0;
    dataManager.users.forEach(user => {
        totalBalanceValue += (user.balance?.usdt || 0) * 1;
        totalBalanceValue += (user.balance?.btc || 0) * 50000;
        totalBalanceValue += (user.balance?.eth || 0) * 3000;
    });
    
    totalBalanceAdmin.textContent = `$${totalBalanceValue.toLocaleString()}`;
    totalTransactions.textContent = dataManager.transactions.length;
    
    let deposits = 0;
    let withdrawals = 0;
    
    dataManager.transactions.forEach(transaction => {
        const amount = parseFloat(transaction.amount.replace(/[^0-9.-]/g, ''));
        if (transaction.type === 'receive') {
            deposits += Math.abs(amount);
        } else if (transaction.type === 'send') {
            withdrawals += Math.abs(amount);
        }
    });
    
    totalDeposits.textContent = `$${deposits.toLocaleString()}`;
    totalWithdrawals.textContent = `$${withdrawals.toLocaleString()}`;
    
    const average = totalBalanceValue / (dataManager.users.length || 1);
    averageBalance.textContent = `$${average.toLocaleString(undefined, {maximumFractionDigits: 2})}`;
    
    // تحديث قائمة طلبات VIP
    updateVipRequestsList();
    
    // تحديث قائمة طلبات السحب
    updateWithdrawalRequestsList();
}

// تحديث قائمة طلبات VIP
function updateVipRequestsList() {
    vipRequestsList.innerHTML = '';
    
    if (dataManager.vipRequests.length === 0) {
        vipRequestsList.innerHTML = '<p style="text-align: center; color: #cccccc;">لا توجد طلبات فتح VIP</p>';
        return;
    }
    
    dataManager.vipRequests.forEach(request => {
        const requestElement = document.createElement('div');
        requestElement.className = 'transaction-item';
        requestElement.innerHTML = `
            <div class="transaction-info">
                <div class="transaction-icon receive">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="transaction-details">
                    <h3>طلب فتح VIP${request.level}</h3>
                    <span>${request.userEmail} • ${request.date}</span>
                </div>
            </div>
            <div class="transaction-amount receive">
                <div class="amount">${request.amount} USDT</div>
                <div class="value" style="color: #00cc00">${request.status}</div>
            </div>
        `;
        vipRequestsList.appendChild(requestElement);
    });
}

// تحديث قائمة طلبات السحب
function updateWithdrawalRequestsList() {
    withdrawalRequestsList.innerHTML = '';
    
    if (dataManager.withdrawalRequests.length === 0) {
        withdrawalRequestsList.innerHTML = '<p style="text-align: center; color: #cccccc;">لا توجد طلبات سحب معلقة</p>';
        return;
    }
    
    dataManager.withdrawalRequests.forEach(request => {
        const requestElement = document.createElement('div');
        requestElement.className = 'transaction-item';
        requestElement.innerHTML = `
            <div class="transaction-info">
                <div class="transaction-icon send">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <div class="transaction-details">
                    <h3>سحب ${request.currency}</h3>
                    <span>${request.userEmail} • ${request.date}</span>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                        ${request.address} • ${request.network}
                    </div>
                </div>
            </div>
            <div class="transaction-amount send">
                <div class="amount">${request.amount} ${request.currency}</div>
                <div class="value" style="color: #ffd700">${request.status}</div>
            </div>
        `;
        withdrawalRequestsList.appendChild(requestElement);
    });
}

// ========== دوال إدارة المستخدمين للمسؤول ==========

// إضافة رصيد
function addBalance(userIndex, currency) {
    const amountInput = document.getElementById(`${currency}-${userIndex}`);
    const amount = parseFloat(amountInput.value);
    
    if (isNaN(amount) || amount <= 0) {
        alert('يرجى إدخال مبلغ صحيح');
        return;
    }
    
    const users = [...dataManager.users];
    if (!users[userIndex].balance) {
        users[userIndex].balance = { usdt: 0, btc: 0, eth: 0 };
    }
    
    users[userIndex].balance[currency] += amount;
    dataManager.users = users;
    
    const transaction = {
        id: 'ADMIN-' + Date.now(),
        type: 'receive',
        description: `إضافة رصيد من المسؤول (${currency.toUpperCase()})`,
        amount: `+${amount} ${currency.toUpperCase()}`,
        value: `$${(amount * 1).toLocaleString()}`,
        date: new Date().toLocaleDateString('ar-EG'),
        status: 'مكتمل',
        timestamp: new Date().toISOString()
    };
    
    dataManager.transactions = [transaction, ...dataManager.transactions];
    
    amountInput.value = '';
    updateAdminUsersTable();
    showToast(`تم إضافة ${amount} ${currency.toUpperCase()} إلى حساب ${users[userIndex].email}`);
}

// سحب رصيد
function withdrawBalance(userIndex, currency) {
    const amountInput = document.getElementById(`${currency}-${userIndex}`);
    const amount = parseFloat(amountInput.value);
    
    if (isNaN(amount) || amount <= 0) {
        alert('يرجى إدخال مبلغ صحيح');
        return;
    }
    
    const users = [...dataManager.users];
    if (!users[userIndex].balance || users[userIndex].balance[currency] < amount) {
        alert('لا يوجد رصيد كافي للسحب');
        return;
    }
    
    users[userIndex].balance[currency] -= amount;
    dataManager.users = users;
    
    const transaction = {
        id: 'ADMIN-' + Date.now(),
        type: 'send',
        description: `سحب رصيد من المسؤول (${currency.toUpperCase()})`,
        amount: `-${amount} ${currency.toUpperCase()}`,
        value: `$${(amount * 1).toLocaleString()}`,
        date: new Date().toLocaleDateString('ar-EG'),
        status: 'مكتمل',
        timestamp: new Date().toISOString()
    };
    
    dataManager.transactions = [transaction, ...dataManager.transactions];
    
    amountInput.value = '';
    updateAdminUsersTable();
    showToast(`تم سحب ${amount} ${currency.toUpperCase()} من حساب ${users[userIndex].email}`);
}

// سحب كامل الرصيد
function withdrawAllBalance(userIndex) {
    const users = [...dataManager.users];
    const user = users[userIndex];
    let totalWithdrawn = 0;
    
    if (user.balance) {
        if (user.balance.usdt > 0) {
            totalWithdrawn += user.balance.usdt;
            user.balance.usdt = 0;
        }
        
        if (user.balance.btc > 0) {
            totalWithdrawn += user.balance.btc * 50000;
            user.balance.btc = 0;
        }
        
        if (user.balance.eth > 0) {
            totalWithdrawn += user.balance.eth * 3000;
            user.balance.eth = 0;
        }
    }
    
    dataManager.users = users;
    
    if (totalWithdrawn > 0) {
        const transaction = {
            id: 'ADMIN-' + Date.now(),
            type: 'send',
            description: `سحب كامل الرصيد من المسؤول`,
            amount: `-${totalWithdrawn.toLocaleString()} USD`,
            value: `$${totalWithdrawn.toLocaleString()}`,
            date: new Date().toLocaleDateString('ar-EG'),
            status: 'مكتمل',
            timestamp: new Date().toISOString()
        };
        
        dataManager.transactions = [transaction, ...dataManager.transactions];
    }
    
    updateAdminUsersTable();
    showToast(`تم سحب كامل الرصيد من حساب ${user.email}`);
}

// حظر مستخدم
function banUser(userIndex) {
    if (confirm(`هل أنت متأكد من حظر المستخدم ${dataManager.users[userIndex].email}؟`)) {
        const users = [...dataManager.users];
        users[userIndex].isBanned = true;
        dataManager.users = users;
        updateAdminUsersTable();
        showToast(`تم حظر المستخدم ${users[userIndex].email}`);
    }
}

// رفع الحظر عن مستخدم
function unbanUser(userIndex) {
    const users = [...dataManager.users];
    users[userIndex].isBanned = false;
    dataManager.users = users;
    updateAdminUsersTable();
    showToast(`تم رفع الحظر عن المستخدم ${users[userIndex].email}`);
}

// ========== إعداد event listeners ==========

function setupEventListeners() {
    // أحداث القوائم المنسدلة
    languageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        languageDropdown.classList.toggle('show');
    });
    
    userBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdown.classList.toggle('show');
    });
    
    document.addEventListener('click', function() {
        languageDropdown.classList.remove('show');
        userDropdown.classList.remove('show');
    });
    
    languageDropdown.addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
    userDropdown.addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
    // أحداث اللغة
    document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            changeLanguage(lang);
            languageBtn.innerHTML = `<i class="fas fa-globe"></i> ${this.textContent} <i class="fas fa-chevron-down"></i>`;
            languageDropdown.classList.remove('show');
        });
    });
    
    // أحداث الإحالة
    copyReferralCode.addEventListener('click', function() {
        copyToClipboard(referralCodeDisplay.textContent);
    });
    
    copyReferralLinkFull.addEventListener('click', function() {
        copyToClipboard(referralLinkDisplay.textContent);
    });
    
    // أحداث التنقل
    balanceBtn.addEventListener('click', showBalanceSection);
    sendBtn.addEventListener('click', showSendSection);
    receiveBtn.addEventListener('click', showReceiveSection);
    vipBtn.addEventListener('click', showVipSection);
    referralNavBtn.addEventListener('click', showReferralSection);
    transactionsBtn.addEventListener('click', showTransactionsSection);
    
    // أحداث النماذج
    cancelSend.addEventListener('click', showBalanceSection);
    sendForm.addEventListener('submit', function(e) {
        e.preventDefault();
        handleSendTransaction();
    });
    
    showLoginBtn.addEventListener('click', showLoginForm);
    showRegisterBtn.addEventListener('click', showRegisterForm);
    registrationForm.addEventListener('submit', function(e) {
        e.preventDefault();
        handleRegistration();
    });
    
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        handleLogin();
    });
    
    logoutBtn.addEventListener('click', handleLogout);
    
    // أحداث تعبئة الرصيد
    copyBtn.addEventListener('click', function() {
        copyToClipboard(addressBox.textContent);
        addressBox.classList.add('copied');
        setTimeout(() => {
            addressBox.classList.remove('copied');
        }, 1000);
    });
    
    addressBox.addEventListener('click', function() {
        copyToClipboard(addressBox.textContent);
        addressBox.classList.add('copied');
        setTimeout(() => {
            addressBox.classList.remove('copied');
        }, 1000);
    });
    
    shareBtn.addEventListener('click', function() {
        if (navigator.share) {
            navigator.share({
                title: 'عنوان محفظتي - محفظة العملات المشفرة الأمريكية',
                text: 'استخدم هذا العنوان لإرسال العملات:',
                url: addressBox.textContent
            });
        } else {
            copyToClipboard(addressBox.textContent);
            showToast('تم نسخ العنوان إلى الحافظة');
        }
    });
    
    // أحداث الشبكات
    networkOptions.forEach(option => {
        option.addEventListener('click', function() {
            networkOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            
            const network = this.getAttribute('data-network');
            addressBox.textContent = addresses[network];
            networkInfo.textContent = networkMessages[network];
            networkInfo.style.display = 'block';
        });
    });
    
    // أحداث إظهار كلمة المرور
    togglePassword.addEventListener('click', function() {
        const passwordInput = document.getElementById('password');
        togglePasswordVisibility(passwordInput, this);
    });
    
    toggleConfirmPassword.addEventListener('click', function() {
        const confirmPasswordInput = document.getElementById('confirmPassword');
        togglePasswordVisibility(confirmPasswordInput, this);
    });
    
    toggleLoginPassword.addEventListener('click', function() {
        const loginPasswordInput = document.getElementById('loginPassword');
        togglePasswordVisibility(loginPasswordInput, this);
    });
    
    // أحداث المسؤول
    adminUsersBtn.addEventListener('click', showAdminUsersSection);
    adminStatsBtn.addEventListener('click', showAdminStatsSection);
    adminLogoutBtn.addEventListener('click', handleAdminLogout);
    
    // معالجة رابط الإحالة
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    if (refCode) {
        document.getElementById('invitationCode').value = refCode;
    }
}

// تغيير اللغة
function changeLanguage(lang) {
    showToast(`تم تغيير اللغة إلى ${lang}`);
}

// التحقق من المستخدم المسجل
function checkLoggedInUser() {
    if (dataManager.currentUser) {
        showWalletInterface();
        userEmailDisplay.textContent = dataManager.currentUser;
    }
}

// ========== التهيئة ==========

function initializePage() {
    checkLoggedInUser();
    setupEventListeners();
    updateBalanceDisplay();
    updateTransactionsDisplay();
    updateVipLevelsDisplay();
    startVipTimer();
    
    if (dataManager.currentUser) {
        checkDailyVipProfits();
        updateReferralStats();
    }
    
    // إضافة مستخدم تجريبي إذا لم يكن هناك مستخدمين
    if (dataManager.users.length === 0) {
        const testUser = {
            email: 'test@example.com',
            password: '123456',
            registrationDate: new Date().toISOString(),
            balance: {
                usdt: 0,
                btc: 0,
                eth: 0
            },
            isBanned: false,
            referralCode: '991271',
            referredBy: '',
            referralStats: {
                totalReferrals: 0,
                activeReferrals: 0,
                totalCommission: 0,
                level1Commission: 0,
                level2Commission: 0
            },
            vipLevels: dataManager.getDefaultVipLevels().map(level => ({
                ...level,
                unlocked: false,
                active: false
            }))
        };
        
        dataManager.users = [testUser];
    }
}

// بدء التطبيق
document.addEventListener('DOMContentLoaded', function() {
    initializePage();
});
</script>
</body>
</html>
